<!DOCTYPE html>
<html>

<head>
  <title>React &amp; Web Socket Example</title>
</head>

<body>
  <div id="app"></div>

  <script type="text/javascript" src="react.min.js"></script>
  <script type="text/javascript" src="JSXTransformer.js"></script>
  <script type="text/javascript" src="jquery-1.10.0.min.js"></script>
  <script type="text/javascript" src="autobahn.min.js"></script>

  <script type="text/jsx">
    /** @jsx React.DOM */

    var FormComponent = React.createClass({
      render: function() {
        return (
          <div id="socket-form">
            <input type="text" id="name" />
            <button>Change Text</button>
          </div>
        )
      }
    });

    var SocketExample = React.createClass({
      getInitialState: function() {
        return {
          name: "Slim Shady"
        }
      },
      render: function() {
        return (
          <div>
            <div className="my-name-is">
              Hi, my name is {this.state.name}
            </div>
            <FormComponent />
          </div>
        )
      }
    });

    var main = React.render(
      <SocketExample />,
      document.getElementById('app')
    );
  </script>

  <script type="text/javascript">
   var wsuri;
   if (document.location.origin == "file://") {
      wsuri = "ws://127.0.0.1:8080/ws";

   } else {
      wsuri = (document.location.protocol === "http:" ? "ws:" : "wss:") + "//" +
                  document.location.host + "/ws";
   }

   // the WAMP connection to the Router
   //
   var connection = new autobahn.Connection({
      url: wsuri,
      realm: "realm1"
   });

    connection.onopen = function(session) {
      connection.session.subscribe('com.example.new_name', function(name) {
        main.setState({name: name});
      });
    };

    connection.open();

    $(document).on('click', '#socket-form button', function() {
      var newName = $('#socket-form #name').val();
      connection.session.publish('com.example.change_name', [newName]);
    });
  </script>
</body>

</html>
